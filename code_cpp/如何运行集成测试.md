# 如何运行集成测试 - 完整指南

## 一、集成测试概述

### 测试方法
采用**自底向上**的集成测试方法

### 测试组
1. **Storage + Search 集成测试**（4个测试用例）
2. **Storage + Statistics 集成测试**（4个测试用例）

### 测试目的
验证不同模块之间的协作是否正常，确保数据在模块间正确传递和处理。

---

## 二、运行集成测试

### 方法1: 使用 Makefile（推荐）

```bash
cd ~/软工/code_cpp

# 清理旧文件
make clean

# 编译并运行集成测试
make test-integration
```

### 方法2: 手动编译运行

如果 Makefile 不工作，可以手动编译：

```bash
cd ~/软工/code_cpp

# 创建 bin 目录
mkdir -p bin

# 编译集成测试
g++ -std=c++17 -O2 -I./src -I./tests -I/usr/include \
    -o bin/test_integration.exe \
    tests/test_integration.cpp \
    src/Category.cpp src/MainUI.cpp src/Record.cpp src/Search.cpp \
    src/Statistics.cpp src/Storage.cpp src/User.cpp \
    -L/usr/lib/x86_64-linux-gnu -L/usr/lib -lgtest -lgtest_main -lpthread

# 运行集成测试
./bin/test_integration.exe
```

---

## 三、预期测试输出

### 成功输出示例

```
Running main() from ./googletest/src/gtest_main.cc
[==========] Running 8 tests from 2 test suites.
[----------] Global test environment set-up.
[----------] 4 tests from StorageSearchIntegrationTest
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword (1 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory (0 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime (0 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria
[       OK ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria (0 ms)
[----------] 4 tests from StorageSearchIntegrationTest (2 ms total)

[----------] 4 tests from StorageStatisticsIntegrationTest
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics
[       OK ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics (0 ms)
[----------] 4 tests from StorageStatisticsIntegrationTest (1 ms total)

[----------] Global test environment tear-down
[==========] 8 tests from 2 test suites ran. (4 ms total)
[  PASSED  ] 8 tests.
```

---

## 四、集成测试详细说明

### 测试组1: Storage + Search 集成

#### 测试用例1: SaveLoadAndSearchByKeyword
- **测试目的**: 验证保存记录、加载记录、然后按关键词搜索的完整流程
- **测试步骤**:
  1. 保存5条测试记录到文件
  2. 从文件加载记录
  3. 设置关键词"工资"并搜索
- **预期结果**: 找到2条类别为"工资"的记录
- **验证点**: Storage和Search模块能够正确协作

#### 测试用例2: SaveLoadAndSearchByCategory
- **测试目的**: 验证保存、加载、按类别搜索的完整流程
- **测试步骤**:
  1. 保存记录
  2. 加载记录
  3. 设置类别"餐饮"并搜索
- **预期结果**: 找到2条类别为"餐饮"的记录
- **验证点**: 类别搜索功能与存储功能集成正常

#### 测试用例3: SaveLoadAndSearchByTime
- **测试目的**: 验证保存、加载、按时间范围搜索的完整流程
- **测试步骤**:
  1. 保存记录
  2. 加载记录
  3. 设置时间范围("2025-01-01", "2025-01-31")并搜索
- **预期结果**: 找到2条日期在范围内的记录
- **验证点**: 时间搜索功能与存储功能集成正常

#### 测试用例4: SaveLoadAndMultipleSearchCriteria
- **测试目的**: 验证组合多个搜索条件的集成流程
- **测试步骤**:
  1. 保存记录
  2. 加载记录
  3. 先按关键词"工资"搜索
  4. 再对结果按时间范围搜索
- **预期结果**: 找到1条同时满足两个条件的记录
- **验证点**: 多个搜索条件可以组合使用

### 测试组2: Storage + Statistics 集成

#### 测试用例1: SaveLoadAndGenerateTimeSummary
- **测试目的**: 验证保存、加载、生成时间统计的完整流程
- **测试步骤**:
  1. 保存5条记录
  2. 加载记录
  3. 生成2025-01期间的时间统计
- **预期结果**: 
  - 收入: 100.0
  - 支出: 80.0
  - 结余: 20.0
  - 记录数: 3
- **验证点**: Statistics模块能够正确处理Storage加载的数据

#### 测试用例2: SaveLoadAndGenerateCategorySummary
- **测试目的**: 验证保存、加载、生成类别统计的完整流程
- **测试步骤**:
  1. 保存记录
  2. 加载记录
  3. 生成类别统计
- **预期结果**: 找到"餐饮"类别，金额为80.0
- **验证点**: 类别统计功能与存储功能集成正常

#### 测试用例3: SaveLoadAndGenerateFullPeriodSummary
- **测试目的**: 验证全期间统计的集成流程
- **测试步骤**:
  1. 保存记录
  2. 加载记录
  3. 生成全期间统计（不指定期间）
- **预期结果**:
  - 总收入: 300.0
  - 总支出: 160.0
  - 净结余: 140.0
  - 记录数: 5
- **验证点**: 全期间统计功能正常

#### 测试用例4: SaveLoadCategoriesAndUseInStatistics
- **测试目的**: 验证类别保存、加载、在统计中使用的完整流程
- **测试步骤**:
  1. 创建默认类别
  2. 添加自定义类别
  3. 保存类别到文件
  4. 从文件加载类别
  5. 验证自定义类别存在
- **预期结果**: 自定义类别被正确保存和加载
- **验证点**: 类别管理功能与存储功能集成正常

---

## 五、常见问题

### 问题1: 找不到 test-integration 目标

**解决方法**: 检查 Makefile 中是否有 test-integration 的编译规则。如果没有，使用手动编译方法。

### 问题2: 编译错误

**可能原因**: GTest 未安装或路径不对

**解决方法**:
```bash
# 检查 GTest 安装
ls /usr/include/gtest/gtest.h
ls /usr/lib/libgtest.a

# 如果未安装，先安装 GTest
sudo apt-get install libgtest-dev
```

### 问题3: 测试失败

**可能原因**: 
- 临时目录权限问题
- 数据文件损坏

**解决方法**:
```bash
# 清理临时文件
make clean
rm -rf tmp_test_integration*

# 重新运行测试
make test-integration
```

---

## 六、截图建议

为了实验报告，建议截图以下内容：

1. **集成测试代码截图**
   - 打开 `tests/test_integration.cpp`
   - 显示测试用例代码

2. **测试执行命令截图**
   - 显示运行 `make test-integration` 的命令
   - 显示编译过程

3. **测试结果截图**
   - 显示所有8个测试通过的状态
   - 显示测试统计信息（通过数、失败数、运行时间等）

4. **测试输出详细截图**
   - 显示每个测试组的测试结果
   - 突出显示测试通过的状态

---

## 七、测试结果记录

运行测试后，请记录：

1. **测试执行时间**: 记录实际执行时间
2. **测试通过情况**: 记录哪些测试通过，哪些失败（如果有）
3. **失败原因分析**: 如果测试失败，分析失败原因
4. **截图保存**: 保存测试执行的截图

---

## 八、快速开始

最简单的运行方式：

```bash
cd ~/软工/code_cpp
make clean
make test-integration
```

如果所有测试通过，你会看到：
```
[  PASSED  ] 8 tests.
```

---

## 九、集成测试报告模板

运行测试后，可以按照以下格式记录结果：

### 集成测试报告

#### 测试环境
- 操作系统: Linux
- 编译器: g++
- 测试框架: Google Test (GTest)

#### 测试结果
- **测试组1 (Storage + Search)**: 4个测试用例，全部通过 ✅
- **测试组2 (Storage + Statistics)**: 4个测试用例，全部通过 ✅
- **总计**: 8个测试用例，全部通过 ✅

#### 测试输出
[粘贴测试输出]

#### 测试分析
[分析测试结果，说明模块间协作是否正常]

---

现在你可以运行集成测试了！如果遇到任何问题，请告诉我。

