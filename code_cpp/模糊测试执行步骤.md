# 模糊测试执行步骤

## 快速执行（5步）

### 步骤1: 安装AFL++

```bash
sudo apt-get update
sudo apt-get install -y afl++
```

**验证安装**:
```bash
afl-fuzz --help
```

**截图**: 显示安装命令和`afl-fuzz --help`输出

---

### 步骤2: 设置模糊测试环境

```bash
cd ~/软工/code_cpp

# 给脚本添加执行权限
chmod +x afl_fuzz_setup.sh

# 运行设置脚本
./afl_fuzz_setup.sh
```

**截图**: 显示设置脚本运行过程和编译成功信息

---

### 步骤3: 运行模糊测试（至少5小时）

#### 方式A: 前台运行（可以看到实时输出）

```bash
afl-fuzz -i fuzz_input -o fuzz_output -- ./fuzz_bin/fuzz_target
```

#### 方式B: 后台运行（推荐，可以运行很长时间）

```bash
# 使用nohup后台运行
nohup afl-fuzz -i fuzz_input -o fuzz_output -- ./fuzz_bin/fuzz_target > fuzz.log 2>&1 &

# 查看运行日志
tail -f fuzz.log

# 查看进程
ps aux | grep afl-fuzz
```

#### 方式C: 使用screen（推荐，可以随时查看）

```bash
# 创建screen会话
screen -S fuzzing

# 在screen中运行
afl-fuzz -i fuzz_input -o fuzz_output -- ./fuzz_bin/fuzz_target

# 分离会话: 按 Ctrl+A 然后按 D
# 重新连接: screen -r fuzzing
```

**截图**: 
- 显示运行命令
- 显示AFL++运行界面（运行时间、统计信息等）

---

### 步骤4: 查看测试结果

#### 如果发现崩溃

```bash
# 查看崩溃文件
ls -lh fuzz_output/default/crashes/

# 查看崩溃文件内容
cat fuzz_output/default/crashes/id:000000*

# 复现崩溃
./fuzz_bin/fuzz_target < fuzz_output/default/crashes/id:000000*
```

**截图**:
- 崩溃文件列表
- 崩溃文件内容
- 复现崩溃的输出（段错误等）

#### 如果未发现崩溃（运行5小时后）

```bash
# 查看统计信息
cat fuzz_output/default/fuzzer_stats

# 查看运行时间
grep "run_time" fuzz_output/default/fuzzer_stats
```

**截图**:
- 显示运行时间（至少5小时）
- 显示`fuzzer_stats`文件内容

---

### 步骤5: 记录结果

将以下信息记录到模糊测试报告中：
1. 安装截图
2. 编译截图
3. 运行截图（显示运行时间）
4. 崩溃用例（如果有）
5. 复现崩溃的截图（如果有）

---

## 预期结果

### 可能发现的问题

AFL++应该能够发现`Storage::copyCategoryName`中的缓冲区溢出问题：

**触发条件**: 当类别名长度>=64字符时
**崩溃类型**: 段错误（SIGSEGV）
**崩溃位置**: `Storage::copyCategoryName()`函数中的`strcpy`调用

### 崩溃用例示例

```
r1	2025-01-01	100.0	I	AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA	测试
```

（类别名是64个或更多的'A'字符）

---

## 常见问题

### Q: 如何停止模糊测试？
A: 按 `Ctrl+C` 停止（前台运行），或使用 `kill` 命令（后台运行）

### Q: 如何查看运行进度？
A: 查看AFL++界面或`fuzzer_stats`文件

### Q: 运行时间不够5小时怎么办？
A: 使用后台运行或screen，让它在后台运行足够长时间

### Q: 在WSL中运行需要注意什么？
A: 需要设置core_pattern，可能需要禁用ASLR

---

## 截图清单

为了实验报告，需要以下截图：

1. ✅ **AFL++安装截图**
   - 安装命令
   - 安装成功信息
   - `afl-fuzz --help`输出

2. ✅ **编译过程截图**
   - 编译命令
   - 编译成功信息

3. ✅ **运行过程截图**
   - 运行命令
   - AFL++运行界面
   - 实时统计信息

4. ✅ **运行时间证明截图**
   - 显示运行时间（至少5小时）
   - `fuzzer_stats`文件内容

5. ✅ **崩溃用例截图**（如果发现）
   - 崩溃文件列表
   - 崩溃文件内容
   - 复现崩溃的输出

---

现在可以开始运行模糊测试了！

