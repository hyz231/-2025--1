# 实验5：模糊测试报告模板

## 一、模糊测试工具选取及安装

### 1.1 工具选择

- **工具名称**: AFL++ (American Fuzzy Lop++)
- **版本**: 3.15a 或更高
- **选择理由**: 
  - 适合C/C++项目
  - 代码覆盖率引导，效率高
  - 能够发现缓冲区溢出、崩溃等安全问题
  - 社区活跃，文档完善

### 1.2 安装过程

#### 安装方法
- **方法**: 使用包管理器安装（Ubuntu/Debian）
- **命令**: `sudo apt-get install afl++`

#### 安装截图
[在此处插入安装截图]
- 显示安装命令
- 显示安装成功的信息
- 显示`afl-fuzz --help`的输出

#### 验证安装
```bash
# 检查afl-fuzz
afl-fuzz --help

# 检查afl-g++
afl-g++ --help
```

---

## 二、模糊测试工具使用说明

### 2.1 目标程序准备

#### 目标程序
- **文件**: `fuzz_test_target.cpp`
- **功能**: 
  - 从标准输入读取TSV格式的记录数据
  - 解析记录并测试Storage功能
  - 测试`copyCategoryName`函数（包含缓冲区溢出缺陷）

#### 编译过程
```bash
# 使用afl-g++编译，启用代码插桩
afl-g++ -std=c++17 -O2 -I./src -o fuzz_bin/fuzz_target \
    fuzz_test_target.cpp src/*.cpp
```

#### 编译截图
[在此处插入编译截图]
- 显示编译命令
- 显示编译成功的信息

### 2.2 测试输入准备

#### 初始测试用例
创建了3个基本的TSV格式测试用例：
- `test1.txt`: 正常记录
- `test2.txt`: 正常记录
- `test3.txt`: 正常记录

#### 输入目录结构
```
fuzz_input/
├── test1.txt
├── test2.txt
└── test3.txt
```

### 2.3 运行模糊测试

#### 运行命令
```bash
afl-fuzz -i fuzz_input -o fuzz_output -- ./fuzz_bin/fuzz_target
```

#### 运行参数说明
- `-i fuzz_input`: 输入目录（包含初始测试用例）
- `-o fuzz_output`: 输出目录（存放测试结果）
- `--`: 分隔AFL++参数和目标程序
- `./fuzz_bin/fuzz_target`: 目标程序路径

#### 运行截图
[在此处插入运行截图]
- 显示运行命令
- 显示AFL++的运行界面
- 显示实时统计信息

---

## 三、模糊测试结果

### 3.1 运行统计

#### 运行时间
- **开始时间**: [填写实际时间]
- **结束时间**: [填写实际时间]
- **总运行时间**: [填写实际时间，至少5小时]

#### 测试统计
- **总执行次数**: [从fuzzer_stats获取]
- **发现的路径数**: [从fuzzer_stats获取]
- **发现的崩溃数**: [从fuzzer_stats获取]
- **发现的挂起数**: [从fuzzer_stats获取]

#### 统计信息截图
[在此处插入fuzzer_stats文件截图]

### 3.2 崩溃用例记录（如果发现）

#### 崩溃用例列表
如果发现崩溃，列出所有崩溃文件：

```
fuzz_output/default/crashes/
├── id:000000,sig:11,src:000000,op:flip1,pos:0
├── id:000001,sig:11,src:000001,op:flip2,pos:1
└── ...
```

#### 崩溃用例内容
[在此处插入崩溃文件内容截图]

**示例崩溃文件内容**:
```
r1	2025-01-01	100.0	I	[超长类别名，超过64字符导致缓冲区溢出]	测试
```

#### 崩溃复现

##### 复现命令
```bash
./fuzz_bin/fuzz_target < fuzz_output/default/crashes/id:000000*
```

##### 复现结果
[在此处插入复现崩溃的截图]
- 显示程序崩溃（段错误）
- 显示崩溃位置和堆栈信息

##### 使用调试器分析
```bash
gdb ./fuzz_bin/fuzz_target
(gdb) run < fuzz_output/default/crashes/id:000000*
(gdb) bt
```

[在此处插入gdb分析截图]

### 3.3 未发现崩溃的情况

如果运行5小时后未发现崩溃：

#### 运行时间证明
[在此处插入运行时间截图]
- 显示AFL++运行界面，运行时间至少5小时
- 显示`fuzzer_stats`文件，确认运行时间

#### 说明
说明已运行足够长时间（至少5小时），但未发现崩溃。这可能是因为：
- 目标程序的缺陷需要特定的输入条件才能触发
- 模糊测试的输入生成策略未能覆盖到触发缺陷的路径
- 程序的错误处理机制捕获了异常输入

---

## 四、测试结果分析

### 4.1 发现的崩溃分析（如果发现）

#### 崩溃类型
- **崩溃类型**: 段错误（SIGSEGV）或其他
- **崩溃位置**: `Storage::copyCategoryName()`函数
- **崩溃原因**: 缓冲区溢出（当类别名长度>=64时）

#### 崩溃触发条件
- **输入格式**: TSV格式的记录
- **关键字段**: 类别字段（第5个字段）
- **触发条件**: 类别名长度>=64字符

#### 崩溃影响
- **严重程度**: 高（可能导致程序崩溃或安全漏洞）
- **影响范围**: 使用`copyCategoryName`函数的所有场景

### 4.2 测试覆盖率

#### 代码覆盖率
- **覆盖的函数**: 
  - `Record::fromTSV()`
  - `Storage::saveRecords()`
  - `Storage::loadRecords()`
  - `Storage::copyCategoryName()`

#### 发现的路径
- **总路径数**: [从fuzzer_stats获取]
- **新路径数**: [从fuzzer_stats获取]

### 4.3 测试有效性评估

- **测试效率**: [评估AFL++的测试效率]
- **发现的问题**: [列出发现的所有问题]
- **测试价值**: [评估模糊测试的价值]

---

## 五、总结

### 5.1 测试成果

- ✅ 成功安装并配置了AFL++模糊测试工具
- ✅ 编译了模糊测试目标程序
- ✅ 运行了模糊测试（至少5小时）
- [如果发现崩溃] ✅ 发现并复现了X个崩溃用例
- [如果未发现崩溃] ✅ 运行了足够长时间，证明了测试的完整性

### 5.2 发现的问题

[列出通过模糊测试发现的所有问题]

### 5.3 改进建议

[根据测试结果提出改进建议]

---

**报告生成时间**: 2025年
**测试工具**: AFL++ (American Fuzzy Lop++)
**测试人员**: [您的姓名]
**审核状态**: 待审核

