# 实验5：集成测试报告

## 一、测试概述

### 1.1 测试目的

本次集成测试旨在：
- 验证不同模块之间的协作是否正常
- 确保数据在模块间能够正确传递和处理
- 验证完整业务流程的正确性
- 发现模块接口之间的潜在问题

### 1.2 测试对象

本次测试针对记账本系统的模块集成进行测试：

1. **Storage + Search 集成**
   - 验证存储模块和搜索模块的协作
   - 测试保存、加载、搜索的完整流程

2. **Storage + Statistics 集成**
   - 验证存储模块和统计模块的协作
   - 测试保存、加载、统计的完整流程

### 1.3 测试环境

- **操作系统**: Linux
- **编译器**: g++ (GCC) 支持C++17标准
- **构建工具**: Make
- **测试框架**: Google Test (GTest) 1.12.0+
- **开发环境**: Visual Studio Code / Cursor

### 1.4 测试工具

- **测试框架**: Google Test (GTest)
- **测试方法**: 自底向上集成测试
- **编译选项**: `-std=c++17 -O2 -I./src -I./tests`

---

## 二、集成测试方法

### 2.1 测试方法选择

采用**自底向上（Bottom-Up）**的集成测试方法。

**自底向上集成测试**：
- 从最底层的模块开始测试
- 逐步向上集成，测试模块间的接口
- 优点：能够早期发现底层模块的问题
- 适合本项目的模块结构

### 2.2 测试策略

1. **先测试单个模块**（已完成单元测试）
   - Storage模块：19个测试用例
   - Search模块：27个测试用例

2. **再测试模块集成**
   - Storage + Search 集成
   - Storage + Statistics 集成

3. **验证数据流**
   - 数据保存 → 数据加载 → 数据处理
   - 确保数据在模块间正确传递

---

## 三、集成测试详细说明

### 3.1 测试组1: Storage + Search 集成

#### 测试目的
验证存储模块和搜索模块能够正确协作，实现保存记录、加载记录、然后进行搜索的完整业务流程。

#### 测试用例1: SaveLoadAndSearchByKeyword
- **测试目的**: 验证保存记录、加载记录、然后按关键词搜索的完整流程
- **测试步骤**:
  1. 创建5条测试记录（包含不同类别和日期）
  2. 使用Storage模块保存记录到文件
  3. 使用Storage模块从文件加载记录
  4. 使用Search模块设置关键词"工资"
  5. 对加载的记录进行关键词搜索
- **预期输出**: 
  - 保存成功
  - 加载后记录数量为5
  - 搜索后找到2条类别为"工资"的记录
- **实际输出**: ✅ 通过
- **测试结果**: 
  ```
  [ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword
  [       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword (1 ms)
  ```
- **验证点**: Storage和Search模块能够正确协作，数据在模块间正确传递

#### 测试用例2: SaveLoadAndSearchByCategory
- **测试目的**: 验证保存、加载、按类别搜索的完整流程
- **测试步骤**:
  1. 保存5条测试记录
  2. 加载记录
  3. 设置类别"餐饮"
  4. 按类别搜索
- **预期输出**: 
  - 找到2条类别为"餐饮"的记录
  - 所有找到的记录类别都是"餐饮"
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory
  [       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory (0 ms)
  ```
- **验证点**: 类别搜索功能与存储功能集成正常

#### 测试用例3: SaveLoadAndSearchByTime
- **测试目的**: 验证保存、加载、按时间范围搜索的完整流程
- **测试步骤**:
  1. 保存5条测试记录（日期分布在1-3月）
  2. 加载记录
  3. 设置时间范围("2025-01-01", "2025-01-31")
  4. 按时间范围搜索
- **预期输出**: 
  - 找到2条日期在2025-01范围内的记录
  - 所有找到的记录的日期都在指定范围内
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime
  [       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime (0 ms)
  ```
- **验证点**: 时间搜索功能与存储功能集成正常

#### 测试用例4: SaveLoadAndMultipleSearchCriteria
- **测试目的**: 验证组合多个搜索条件的集成流程
- **测试步骤**:
  1. 保存5条测试记录
  2. 加载记录
  3. 先按关键词"工资"搜索，得到结果集A
  4. 对结果集A按时间范围("2025-01-01", "2025-01-31")搜索
- **预期输出**: 
  - 第一步搜索找到2条"工资"记录
  - 第二步搜索找到1条同时满足两个条件的记录
  - 该记录的日期为"2025-01-01"，类别为"工资"
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria
  [       OK ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria (0 ms)
  ```
- **验证点**: 多个搜索条件可以组合使用，搜索功能支持链式调用

---

### 3.2 测试组2: Storage + Statistics 集成

#### 测试目的
验证存储模块和统计模块能够正确协作，实现保存记录、加载记录、然后进行统计分析的完整业务流程。

#### 测试用例1: SaveLoadAndGenerateTimeSummary
- **测试目的**: 验证保存、加载、生成时间统计的完整流程
- **测试步骤**:
  1. 创建5条测试记录：
     - r1: 2025-01-01, 100.0, 收入, "工资"
     - r2: 2025-01-15, 50.0, 支出, "餐饮"
     - r3: 2025-01-20, 30.0, 支出, "餐饮"
     - r4: 2025-02-01, 200.0, 收入, "奖金"
     - r5: 2025-02-10, 80.0, 支出, "购物"
  2. 保存记录
  3. 加载记录
  4. 创建Statistics对象，设置期间为"2025-01"
  5. 生成时间统计
- **预期输出**: 
  - 收入: 100.0（只有r1在2025-01期间）
  - 支出: 80.0（r2和r3在2025-01期间）
  - 结余: 20.0
  - 记录数: 3
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary
  [       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary (0 ms)
  ```
- **验证点**: Statistics模块能够正确处理Storage加载的数据，期间过滤功能正常

#### 测试用例2: SaveLoadAndGenerateCategorySummary
- **测试目的**: 验证保存、加载、生成类别统计的完整流程
- **测试步骤**:
  1. 保存5条测试记录
  2. 加载记录
  3. 创建Statistics对象，设置模式为Category
  4. 生成类别统计
- **预期输出**: 
  - 统计结果包含多个类别
  - "餐饮"类别的金额为80.0（r2: 50.0 + r3: 30.0）
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary
  [       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary (0 ms)
  ```
- **验证点**: 类别统计功能与存储功能集成正常，能够正确聚合同类别的金额

#### 测试用例3: SaveLoadAndGenerateFullPeriodSummary
- **测试目的**: 验证全期间统计的集成流程
- **测试步骤**:
  1. 保存5条测试记录
  2. 加载记录
  3. 创建Statistics对象，不指定期间（空字符串）
  4. 生成全期间统计
- **预期输出**: 
  - 总收入: 300.0（r1: 100.0 + r4: 200.0）
  - 总支出: 160.0（r2: 50.0 + r3: 30.0 + r5: 80.0）
  - 净结余: 140.0
  - 记录数: 5
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary
  [       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary (0 ms)
  ```
- **验证点**: 全期间统计功能正常，能够正确处理所有记录

#### 测试用例4: SaveLoadCategoriesAndUseInStatistics
- **测试目的**: 验证类别保存、加载、在统计中使用的完整流程
- **测试步骤**:
  1. 创建默认类别列表
  2. 添加自定义类别"自定义类别"
  3. 使用Storage模块保存类别到文件
  4. 使用Storage模块从文件加载类别
  5. 验证自定义类别存在且标记为自定义
- **预期输出**: 
  - 保存成功
  - 加载后类别列表不为空
  - 找到"自定义类别"，且`isCustom()`返回true
- **实际输出**: ✅ 通过
- **测试结果**:
  ```
  [ RUN      ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics
  [       OK ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics (0 ms)
  ```
- **验证点**: 类别管理功能与存储功能集成正常，自定义类别能够正确保存和加载

---

## 四、测试结果分析

### 4.1 测试执行结果

#### 实际测试输出

```
Running Integration tests...
./bin/test_integration.exe
Running main() from ./googletest/src/gtest_main.cc
[==========] Running 8 tests from 2 test suites.
[----------] Global test environment set-up.
[----------] 4 tests from StorageSearchIntegrationTest
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByKeyword (1 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByCategory (0 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime
[       OK ] StorageSearchIntegrationTest.SaveLoadAndSearchByTime (0 ms)
[ RUN      ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria
[       OK ] StorageSearchIntegrationTest.SaveLoadAndMultipleSearchCriteria (0 ms)
[----------] 4 tests from StorageSearchIntegrationTest (2 ms total)

[----------] 4 tests from StorageStatisticsIntegrationTest
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateTimeSummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateCategorySummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary
[       OK ] StorageStatisticsIntegrationTest.SaveLoadAndGenerateFullPeriodSummary (0 ms)
[ RUN      ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics
[       OK ] StorageStatisticsIntegrationTest.SaveLoadCategoriesAndUseInStatistics (0 ms)
[----------] 4 tests from StorageStatisticsIntegrationTest (0 ms total)

[----------] Global test environment tear-down
[==========] 8 tests from 2 test suites ran. (2 ms total)
[  PASSED  ] 8 tests.
```

#### 测试统计

| 测试组 | 测试用例数 | 通过数 | 失败数 | 通过率 | 执行时间 |
|--------|-----------|-------|--------|--------|----------|
| Storage + Search | 4 | 4 | 0 | 100% | 2 ms |
| Storage + Statistics | 4 | 4 | 0 | 100% | 0 ms |
| **总计** | **8** | **8** | **0** | **100%** | **2 ms** |

### 4.2 测试结果分析

#### 测试组1: Storage + Search 集成

**测试结果**: ✅ 全部通过（4/4）

**分析**:
- ✅ 数据保存和加载功能正常
- ✅ 关键词搜索功能与存储功能集成正常
- ✅ 类别搜索功能与存储功能集成正常
- ✅ 时间范围搜索功能与存储功能集成正常
- ✅ 多个搜索条件可以组合使用
- ✅ 数据在Storage和Search模块间正确传递

**结论**: Storage和Search模块的集成测试全部通过，模块间协作正常，接口设计合理。

#### 测试组2: Storage + Statistics 集成

**测试结果**: ✅ 全部通过（4/4）

**分析**:
- ✅ 时间统计功能与存储功能集成正常
- ✅ 类别统计功能与存储功能集成正常
- ✅ 全期间统计功能正常
- ✅ 类别管理功能与存储功能集成正常
- ✅ 数据在Storage和Statistics模块间正确传递
- ✅ 统计计算准确（收入、支出、结余、记录数）

**结论**: Storage和Statistics模块的集成测试全部通过，模块间协作正常，统计功能准确。

### 4.3 集成测试质量评估

- **测试完整性**: ✅ 优秀 - 覆盖了主要的模块集成场景
- **测试有效性**: ✅ 优秀 - 所有测试都通过，验证了模块间协作
- **测试效率**: ✅ 优秀 - 执行速度快（2ms），测试用例设计合理
- **测试可维护性**: ✅ 良好 - 测试代码结构清晰，易于理解和修改

### 4.4 发现的潜在问题

通过集成测试，我们发现：

1. **模块接口设计合理**: 所有模块间的数据传递都正常，接口设计良好
2. **数据一致性**: 数据在保存、加载、处理过程中保持一致
3. **功能完整性**: 所有集成功能都能正常工作
4. **性能良好**: 集成测试执行速度快，性能表现良好

**未发现集成问题**: 所有集成测试通过，模块间协作正常。

---

## 五、测试覆盖率说明

### 5.1 集成测试覆盖的模块

- ✅ Storage模块 - 保存、加载功能
- ✅ Search模块 - 关键词搜索、类别搜索、时间搜索功能
- ✅ Statistics模块 - 时间统计、类别统计功能
- ✅ Category模块 - 类别管理功能

### 5.2 覆盖的业务流程

1. ✅ **数据持久化流程**: 保存 → 加载
2. ✅ **搜索业务流程**: 保存 → 加载 → 搜索
3. ✅ **统计业务流程**: 保存 → 加载 → 统计
4. ✅ **类别管理流程**: 创建 → 保存 → 加载 → 使用

### 5.3 覆盖的集成场景

- ✅ 两个模块的集成（Storage + Search, Storage + Statistics）
- ✅ 数据在不同模块间的传递
- ✅ 模块功能的组合使用
- ✅ 完整业务流程的端到端测试

---

## 六、测试截图说明

### 6.1 需要提供的截图

根据实验要求，需要提供以下截图证明：

1. **集成测试代码截图**
   - 打开 `tests/test_integration.cpp`
   - 显示测试用例代码

2. **测试执行结果截图**
   - 运行 `make test-integration` 的命令
   - 显示所有8个测试通过的状态
   - 显示测试统计信息

3. **测试输出详细截图**
   - 显示每个测试组的测试结果
   - 突出显示测试通过的状态

### 6.2 截图示例说明

**测试执行命令**:
```bash
cd code_cpp
make test-integration
```

**预期输出**: 如上所示的测试输出，显示所有8个测试通过。

---

## 七、总结

### 7.1 测试成果

- ✅ 完成了2组集成测试（Storage + Search, Storage + Statistics）
- ✅ 每组测试包含4个测试用例，共8个测试用例
- ✅ 所有测试用例全部通过（8/8）
- ✅ 验证了模块间的协作正常
- ✅ 验证了完整业务流程的正确性

### 7.2 测试价值

通过本次集成测试：
1. 验证了模块接口设计的正确性
2. 确保了数据在模块间正确传递
3. 验证了完整业务流程的功能
4. 提高了代码质量和系统可靠性

### 7.3 后续工作

- 进行模糊测试，发现潜在的边界问题
- 使用缺陷检测工具发现并修复问题
- 配置持续集成，自动化测试流程

---

**报告生成时间**: 2025年
**测试框架**: Google Test (GTest)
**测试方法**: 自底向上集成测试
**测试人员**: [您的姓名]
**审核状态**: 待审核

